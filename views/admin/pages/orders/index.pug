extends ../../layouts/default.pug
include ../../mixins/alert.pug
include ../../mixins/error404.pug

block main
    +showAlertSuccess(5000)
    +showAlertError(5000)
    if (role.permissions.includes('orders_view'))
        h1.mb-4
            i.bi.bi-cart-check.me-2
            | Danh sách đơn hàng

        .card.mb-3.shadow-sm
            .card-header.bg-primary.text-white.d-flex.justify-content-between.align-items-center
                span
                    i.bi.bi-list-ul.me-2
                    | Danh sách
                if (role.permissions.includes('orders_create'))
                    a(
                        href=`${prefixAdmin}/orders/create`
                        class="btn btn-success btn-sm"
                    )
                        i.bi.bi-plus-lg.me-1
                        | Thêm mới

            .card-body
                table.table.table-hover.table-bordered.align-middle
                    thead.table-light
                        tr
                            th.text-center.align-middle(style="width: 50px") #
                            th.text-center.align-middle Mã đơn hàng
                            th.text-center.align-middle Khách đặt
                            th.text-center.align-middle Khách nhận
                            th.text-center.align-middle Số lượng
                            th.text-center.align-middle Tổng tiền
                            th.text-center.align-middle Trạng thái
                            th.text-center.align-middle Hành động

                    tbody
                        each item, index in records
                            tr 
                                td.text-center #{index+1}
                                td.text-center
                                    i.bi.bi-hash.me-1
                                    | #{item.code}
                                td
                                    i.bi.bi-person.me-1
                                    | #{item.userFullName}
                                td
                                    i.bi.bi-person-check.me-1
                                    | #{item.userInfo.fullName}
                                td.text-center
                                    i.bi.bi-box-seam.me-1
                                    | #{item.totalQuantity}
                                td.text-center
                                    i.bi.bi-currency-dollar.me-1
                                    | #{item.totalPrice}
                                td.text-center
                                    if (item.status === "approved")
                                        span.badge.bg-success.d-inline-flex.align-items-center(data-status="approved")
                                            i.bi.bi-check-circle.me-1
                                            | Đã duyệt
                                    else if (item.status === "pending")
                                        span.badge.bg-warning.text-dark.d-inline-flex.align-items-center(data-status="pending")
                                            i.bi.bi-hourglass-split.me-1
                                            | Đang xử lý
                                    else
                                        span.badge.bg-danger.d-inline-flex.align-items-center(data-status="rejected")
                                            i.bi.bi-x-circle.me-1
                                            | Đã từ chối
                                td.text-center
                                    a(
                                        class="btn btn-secondary btn-sm me-1"
                                        href=`${prefixAdmin}/orders/detail/${item.id}`
                                        title="Chi tiết"
                                    )
                                        i.bi.bi-eye.me-1
                                        | Chi tiết
                                    if (role.permissions.includes('orders_approval') && item.status === 'pending')
                                        form(
                                            method="post"
                                            action=`${prefixAdmin}/orders/approve/${item.id}?_method=PATCH`
                                            style="display:inline"
                                        )
                                            button(
                                                type="submit"
                                                class="btn btn-success btn-sm me-1"
                                                title="Duyệt"
                                            )
                                                i.bi.bi-pencil-square.me-1
                                                | Duyệt
                                    if (role.permissions.includes('orders_approval') && item.status === 'pending')
                                      form(
                                            method="post"
                                            action=`${prefixAdmin}/orders/reject/${item.id}?_method=PATCH`
                                            style="display:inline"
                                        )
                                            button(
                                                type="submit"
                                                class="btn btn-danger btn-sm me-1"
                                                title="Từ Chối"
                                            )
                                                i.bi.bi-x-lg.me-1
                                                | Từ chối
    else
        +error404()